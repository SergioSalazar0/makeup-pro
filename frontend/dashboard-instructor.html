<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="./cbtis258-logo.webp">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Dashboard Instructor</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />


    <!-- Bootstrap core CSS     -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="assets/css/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="assets/css/light-bootstrap-dashboard.css?v=1.4.0" rel="stylesheet"/>


    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="assets/css/demo.css" rel="stylesheet" />


    <!--     Fonts and icons     -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="assets/css/pe-icon-7-stroke.css" rel="stylesheet" />
    
    <!-- FullCalendar CSS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css' rel='stylesheet' />
    <!-- Chartist CSS -->
    <link href="https://cdn.jsdelivr.net/npm/chartist@0.11.4/dist/chartist.min.css" rel="stylesheet" />
</head>
<body>

<div class="wrapper">
    <div class="sidebar" data-color="purple" data-image="assets/img/maestro.jpeg">

    <!--   you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple" -->


    	<div class="sidebar-wrapper">
            <div class="logo">
                <a href="" class="simple-text">
                    DASHBOARD
                </a>
            </div>

            <ul class="nav">
                <li>
                </li>
                <li class="active" id="menu-perfil">
                    <a href="javascript:void(0)" onclick="mostrarSeccion('perfil')">
                        <i class="pe-7s-user"></i>
                        <p>Perfil Usuario</p>
                    </a>
                </li>
                <li id="menu-calendario">
                    <a href="javascript:void(0)" onclick="mostrarSeccion('calendario')">
                      <i class="pe-7s-date"></i>
                        <p>Calendario</p>
                    </a>
                </li>
                <li id="menu-avisos">
                    <a href="javascript:void(0)" onclick="mostrarSeccion('avisos')">
                       <i class="pe-7s-pin"></i>
                        <p>Avisos</p>
                    </a>
                </li>
                <li id="menu-alumnos">
                    <a href="javascript:void(0)" onclick="mostrarSeccion('alumnos')">
                        <i class="pe-7s-users"></i>
                        <p>Alumnos inscritos</p>
                    </a>
                </li>
                 <li>
                    <a href="#" onclick="cerrarSesion()">
                        <i class="pe-7s-power"></i>
                        <p>Cerrar Sesi√≥n</p>
                    </a>
                </li>
            </ul>
    	</div>
    </div>

    <div class="main-panel">
		<nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">Usuario</a>
                </div>
                <div class="collapse navbar-collapse">
                   

                    <ul class="nav navbar-nav navbar-right">
                        
                        
                        <li>
                            <a href="#" onclick="cerrarSesion()">
                                <p>Salir</p>
                            </a>
                        </li>
						<li class="separator hidden-lg hidden-md"></li>
                    </ul>
                </div>
            </div>
        </nav>


        <div class="content" id="seccion-perfil">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Perfil</h4>
                            </div>
                            <div class="content">
                                <form onsubmit="actualizarPerfil(event)">
                                    <div class="row">
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label>Plantel</label>
                                                <input type="text" class="form-control" disabled placeholder="Plantel" value="CBTis No.258 Mariano Escobedo">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label>Nombre del instructor</label>
                                                <input type="text" id="nombre" class="form-control" placeholder="Nombre(s)" required>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group">
                                                <label for="apellidos">Apellidos</label>
                                                <input type="text" id="apellidos" class="form-control" placeholder="Apellido Paterno Materno" required>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>Especialidad</label>
                                                <input type="text" id="especialidad" class="form-control" placeholder="Ej: Educaci√≥n F√≠sica, Artes, M√∫sica">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>Tel√©fono</label>
                                                <input type="tel" id="telefono" class="form-control" placeholder="N√∫mero de tel√©fono personal">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>Contacto de emergencia</label>
                                                <input type="text" id="contacto_emergencia" class="form-control" placeholder="Nombre del contacto">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label>N√∫mero de emergencia</label>
                                                <input type="tel" id="telefono_emergencia" class="form-control" placeholder="Tel√©fono del contacto">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>Direcci√≥n</label>
                                                <input type="text" id="direccion" class="form-control" placeholder="Direcci√≥n completa">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label>Descripci√≥n del instructor</label>
                                                <textarea rows="5" id="descripcion" class="form-control" placeholder="Descripci√≥n, logros y habilidades"></textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <button type="submit" class="btn btn-info btn-fill pull-right">Actualizar Perfil</button>
                                    <div class="clearfix"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card card-user">
                            <div class="image">
                                <img src="./assets/img/combr-fond.png" alt="..."/>
                            </div>
                            <div class="content">
                                <div class="author">
                                     <a href="#">
                                    <img class="avatar border-gray" src="assets/img/user-img.png" alt="..."/>

                                      <h4 class="title" id="instructor-name">Instructor<br />
                                         <small id="instructor-email">@instructor</small>
                                      </h4>
                                    </a>
                                </div>
                                <p class="description text-center" id="instructor-descripcion">
                                    Cargando informaci√≥n...
                                </p>
                            </div>
                            <hr>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Secci√≥n Calendario -->
        <div class="content" id="seccion-calendario" style="display: none;">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Calendario de Eventos</h4>
                                <p class="category">Gestiona las fechas importantes de tus talleres</p>
                                <button class="btn btn-info btn-fill" onclick="mostrarModalEvento()">
                                    <i class="pe-7s-plus"></i> Nuevo Evento
                                </button>
                            </div>
                            <div class="content">
                                <div id="calendar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal para crear/editar evento -->
                <div id="modalEvento" class="modal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.4);">
                    <div style="background-color:#fefefe; margin:5% auto; padding:20px; border:1px solid #888; width:50%; border-radius:5px;">
                        <span onclick="cerrarModalEvento()" style="color:#aaa; float:right; font-size:28px; font-weight:bold; cursor:pointer;">&times;</span>
                        <h3>Crear Evento</h3>
                        <form id="formEvento" onsubmit="guardarEvento(event)">
                            <div class="form-group">
                                <label>Taller *</label>
                                <select id="evento-taller" class="form-control" required>
                                    <option value="">Selecciona un taller...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>T√≠tulo *</label>
                                <input type="text" id="evento-titulo" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <textarea id="evento-descripcion" class="form-control" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Evento *</label>
                                <select id="evento-tipo" class="form-control" required>
                                    <option value="evento">Evento</option>
                                    <option value="examen">Examen</option>
                                    <option value="entrega">Entrega</option>
                                    <option value="practica">Pr√°ctica</option>
                                    <option value="reunion">Reuni√≥n</option>
                                    <option value="suspension">Suspensi√≥n</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Fecha *</label>
                                <input type="date" id="evento-fecha" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-info btn-fill">Guardar Evento</button>
                            <button type="button" class="btn btn-default" onclick="cerrarModalEvento()">Cancelar</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n Avisos -->
        <div class="content" id="seccion-avisos" style="display: none;">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Avisos y Notificaciones</h4>
                                <p class="category">Publica avisos importantes para tus alumnos</p>
                            </div>
                            <div class="content">
                                <button class="btn btn-info btn-fill" onclick="mostrarModalAviso()">
                                    <i class="pe-7s-plus"></i> Nuevo Aviso
                                </button>
                                <div class="row" style="margin-top: 20px;">
                                    <div class="col-md-12">
                                        <div class="table-responsive">
                                            <table class="table table-hover table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>Taller</th>
                                                        <th>T√≠tulo</th>
                                                        <th>Contenido</th>
                                                        <th>Fecha Publicaci√≥n</th>
                                                        <th>Importante</th>
                                                        <th>Estado</th>
                                                        <th>Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tabla-avisos">
                                                    <tr>
                                                        <td colspan="7" class="text-center">
                                                            <i class="pe-7s-refresh" style="font-size: 24px;"></i>
                                                            <p>Cargando avisos...</p>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n Alumnos -->
        <div class="content" id="seccion-alumnos" style="display: none;">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Alumnos Inscritos</h4>
                                <p class="category">Lista de alumnos en tus talleres</p>
                            </div>
                            <div class="content">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Seleccionar Taller</label>
                                            <select class="form-control" id="select-taller-alumnos" onchange="cargarAlumnosPorTaller()">
                                                <option value="">Selecciona un taller...</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>Buscar Alumno</label>
                                            <input type="text" class="form-control" id="buscar-alumno" placeholder="Nombre, No. Control..." onkeyup="buscarAlumno()">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>&nbsp;</label>
                                            <div>
                                                <span class="label label-info" id="total-alumnos">0 alumnos</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="table-responsive">
                                            <table class="table table-hover table-striped">
                                                <thead>
                                                    <tr>
                                                        <th>No. Control</th>
                                                        <th>Nombre Completo</th>
                                                        <th>Grupo</th>
                                                        <th>Semestre</th>
                                                        <th>Email</th>
                                                        <th>Tel√©fono</th>
                                                        <th>Acciones</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tabla-alumnos">
                                                    <tr>
                                                        <td colspan="7" class="text-center">
                                                            <p>Selecciona un taller para ver los alumnos inscritos</p>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <footer class="footer">
            <div class="container-fluid">
                <nav class="pull-left">
                    <ul>
                        <li>
                            <a href="#">
                                Home
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Company
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                Portfolio
                            </a>
                        </li>
                        <li>
                            <a href="#">
                               Blog
                            </a>
                        </li>
                    </ul>
                </nav>
                <p class="copyright pull-right">
                    &copy; <script>document.write(new Date().getFullYear())</script> <a href="https://www.creative-tim.com">Creative Tim</a>, made with love for a better web
                </p>
            </div>
        </footer>

    </div>
</div>

<!-- Modal para Crear/Editar Aviso -->
<div class="modal fade" id="modalAviso" tabindex="-1" role="dialog" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" onclick="cerrarModalAviso()">&times;</button>
                <h4 class="modal-title" id="tituloModalAviso">Nuevo Aviso</h4>
            </div>
            <div class="modal-body">
                <form id="formAviso">
                    <input type="hidden" id="aviso-id">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Taller *</label>
                                <select class="form-control" id="aviso-taller" required>
                                    <option value="">Selecciona un taller...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group">
                                <label>T√≠tulo *</label>
                                <input type="text" class="form-control" id="aviso-titulo" placeholder="T√≠tulo del aviso" required maxlength="200">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div>
                                    <label style="cursor: pointer; display: flex; align-items: center; margin-top: 8px;">
                                        <input type="checkbox" id="aviso-importante" style="width: 18px; height: 18px; margin-right: 8px; cursor: pointer;">
                                        <strong>Marcar como importante</strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Contenido *</label>
                                <textarea class="form-control" id="aviso-contenido" rows="5" placeholder="Escribe el contenido del aviso..." required></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Fecha de Publicaci√≥n *</label>
                                <input type="datetime-local" class="form-control" id="aviso-fecha-publicacion" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Fecha de Expiraci√≥n (opcional)</label>
                                <input type="datetime-local" class="form-control" id="aviso-fecha-expiracion">
                                <small class="form-text text-muted">Deja vac√≠o si no expira</small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" onclick="cerrarModalAviso()">Cancelar</button>
                <button type="button" class="btn btn-info btn-fill" onclick="guardarAviso()">Guardar Aviso</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Informaci√≥n de Emergencia -->
<div class="modal fade" id="modalEmergencia" tabindex="-1" role="dialog" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" onclick="cerrarModalEmergencia()">&times;</button>
                <h4 class="modal-title">Informaci√≥n de Emergencia</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <h5><strong id="emergencia-nombre-alumno"></strong></h5>
                        <p class="text-muted" id="emergencia-datos-alumno"></p>
                        <hr>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <h5><i class="pe-7s-call"></i> Contacto de Emergencia</h5>
                        <table class="table">
                            <tr>
                                <td><strong>Nombre:</strong></td>
                                <td id="emergencia-contacto-nombre">-</td>
                            </tr>
                            <tr>
                                <td><strong>Tel√©fono:</strong></td>
                                <td id="emergencia-contacto-telefono">-</td>
                            </tr>
                            <tr>
                                <td><strong>Relaci√≥n:</strong></td>
                                <td id="emergencia-contacto-relacion">-</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h5><i class="pe-7s-note2"></i> Informaci√≥n M√©dica</h5>
                        <table class="table">
                            <tr>
                                <td><strong>Tipo de Sangre:</strong></td>
                                <td id="emergencia-tipo-sangre">-</td>
                            </tr>
                            <tr>
                                <td><strong>Alergias:</strong></td>
                                <td id="emergencia-alergias">-</td>
                            </tr>
                            <tr>
                                <td><strong>Medicamentos:</strong></td>
                                <td id="emergencia-medicamentos">-</td>
                            </tr>
                            <tr>
                                <td><strong>Condiciones:</strong></td>
                                <td id="emergencia-condiciones">-</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" onclick="cerrarModalEmergencia()">Cerrar</button>
            </div>
        </div>
    </div>
</div>

</body>

      <script src="js/config.js"></script>

    <!--   Core JS Files   -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- jQuery desde CDN -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <!-- Bootstrap JS desde CDN -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- Chartist desde CDN -->
	<script src="https://cdn.jsdelivr.net/npm/chartist@0.11.4/dist/chartist.min.js"></script>
    <!-- Bootstrap Notify desde CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-notify@3.1.3/bootstrap-notify.min.js"></script>

    <!--  Google Maps Plugin    -->
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>

    <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
	<script src="assets/js/light-bootstrap-dashboard.js?v=1.4.0"></script>

	<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
	<script src="assets/js/demo.js"></script>
	
	<!-- FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/locales/es.js'></script>

    <script>
        // Configuraci√≥n de Axios
        let calendar; // Variable global para el calendario
        
        // Funci√≥n para cambiar entre secciones
        function mostrarSeccion(seccion) {
            // Ocultar todas las secciones
            document.getElementById('seccion-perfil').style.display = 'none';
            document.getElementById('seccion-calendario').style.display = 'none';
            document.getElementById('seccion-avisos').style.display = 'none';
            document.getElementById('seccion-alumnos').style.display = 'none';
            
            // Remover clase active de todos los men√∫s
            document.getElementById('menu-perfil').classList.remove('active');
            document.getElementById('menu-calendario').classList.remove('active');
            document.getElementById('menu-avisos').classList.remove('active');
            document.getElementById('menu-alumnos').classList.remove('active');
            
            // Mostrar la secci√≥n seleccionada y activar su men√∫
            document.getElementById('seccion-' + seccion).style.display = 'block';
            document.getElementById('menu-' + seccion).classList.add('active');
            
            // Si se muestra el calendario, renderizarlo
            if (seccion === 'calendario') {
                setTimeout(() => {
                    if (calendar) {
                        calendar.render();
                        calendar.refetchEvents();
                    } else {
                        inicializarCalendario();
                    }
                }, 100);
            }
            
            // Si se muestra avisos, cargar avisos
            if (seccion === 'avisos') {
                setTimeout(() => {
                    cargarAvisos();
                }, 100);
            }
            
            // Si se muestra alumnos, cargar talleres
            if (seccion === 'alumnos') {
                setTimeout(() => {
                    cargarTalleresParaAlumnos();
                }, 100);
            }
        }
        
        // Inicializar FullCalendar
        function inicializarCalendario() {
            const calendarEl = document.getElementById('calendar');
            
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'es',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                buttonText: {
                    today: 'Hoy',
                    month: 'Mes',
                    week: 'Semana',
                    list: 'Lista'
                },
                events: function(info, successCallback, failureCallback) {
                    cargarEventos(info.start, info.end, successCallback, failureCallback);
                },
                eventClick: function(info) {
                    mostrarDetalleEvento(info.event);
                },
                dateClick: function(info) {
                    mostrarModalEvento(info.dateStr);
                },
                height: 'auto'
            });
            
            calendar.render();
        }
        
        // Cargar eventos del backend
        async function cargarEventos(start, end, successCallback, failureCallback) {
            try {
                const startDate = start.toISOString().split('T')[0];
                const endDate = end.toISOString().split('T')[0];
                
                const response = await axios.get(`${API_BASE_URL}/calendario/rango`, {
                    params: {
                        fechaInicio: startDate,
                        fechaFin: endDate
                    }
                });
                
                console.log('üìÖ Respuesta del calendario:', response.data);
                
                // El backend devuelve un objeto agrupado por fecha: { "2025-11-14": [eventos] }
                // Necesitamos convertirlo a un array plano
                const eventosData = response.data.data || {};
                let eventos = [];
                
                // Si es un objeto (agrupado por fecha), convertirlo a array
                if (typeof eventosData === 'object' && !Array.isArray(eventosData)) {
                    // Iterar sobre cada fecha
                    Object.keys(eventosData).forEach(fecha => {
                        const eventosDeFecha = eventosData[fecha];
                        if (Array.isArray(eventosDeFecha)) {
                            eventosDeFecha.forEach(evento => {
                                eventos.push({
                                    id: evento.id,
                                    title: evento.titulo,
                                    start: evento.fecha_evento,
                                    description: evento.descripcion,
                                    tipo: evento.tipo_evento,
                                    taller: evento.taller_nombre,
                                    backgroundColor: getColorByType(evento.tipo_evento),
                                    borderColor: getColorByType(evento.tipo_evento)
                                });
                            });
                        }
                    });
                } else if (Array.isArray(eventosData)) {
                    // Si ya es un array, procesarlo directamente
                    eventos = eventosData.map(evento => ({
                        id: evento.id,
                        title: evento.titulo,
                        start: evento.fecha_evento,
                        description: evento.descripcion,
                        tipo: evento.tipo_evento,
                        taller: evento.taller_nombre,
                        backgroundColor: getColorByType(evento.tipo_evento),
                        borderColor: getColorByType(evento.tipo_evento)
                    }));
                }
                
                console.log('üìÖ Eventos procesados:', eventos);
                successCallback(eventos);
                
            } catch (error) {
                console.error('‚ùå Error al cargar eventos:', error);
                console.error('‚ùå Detalles del error:', error.response?.data);
                // No fallar, simplemente retornar array vac√≠o
                successCallback([]);
            }
        }
        
        // Obtener color seg√∫n tipo de evento
        function getColorByType(tipo) {
            const colores = {
                'evento': '#5bc0de',      // Azul claro
                'examen': '#d9534f',      // Rojo
                'entrega': '#f0ad4e',     // Naranja
                'practica': '#5cb85c',    // Verde
                'reunion': '#9B59B6',     // Morado
                'suspension': '#95a5a6'   // Gris
            };
            return colores[tipo] || '#5bc0de';
        }
        
        // Mostrar formulario para crear evento
        function mostrarFormEvento(fecha = null) {
            const titulo = prompt('T√≠tulo del evento:');
            if (!titulo) return;
            
            const descripcion = prompt('Descripci√≥n (opcional):');
            const tipo = prompt('Tipo de evento (evento/examen/entrega/practica/reunion/suspension):', 'evento');
            const fechaEvento = fecha || prompt('Fecha del evento (YYYY-MM-DD):');
            
            if (!fechaEvento) {
                alert('La fecha es requerida');
                return;
            }
            
            crearEvento({
                titulo,
                descripcion,
                tipo_evento: tipo,
                fecha_evento: fechaEvento
            });
        }
        
        // Mostrar modal para crear evento
        async function mostrarModalEvento(fecha = null) {
            // Cargar talleres del instructor
            await cargarTalleresInstructor();
            
            // Establecer fecha si se proporcion√≥
            if (fecha) {
                document.getElementById('evento-fecha').value = fecha;
            } else {
                document.getElementById('evento-fecha').value = new Date().toISOString().split('T')[0];
            }
            
            // Limpiar formulario
            document.getElementById('evento-titulo').value = '';
            document.getElementById('evento-descripcion').value = '';
            document.getElementById('evento-tipo').value = 'evento';
            
            // Mostrar modal
            document.getElementById('modalEvento').style.display = 'block';
        }
        
        // Cerrar modal
        function cerrarModalEvento() {
            document.getElementById('modalEvento').style.display = 'none';
        }
        
        // Cargar talleres del instructor
        async function cargarTalleresInstructor() {
            try {
                // Usar el endpoint espec√≠fico para instructores
                const response = await axios.get(`${API_BASE_URL}/talleres/mis-talleres`);
                
                console.log('üë®‚Äçüè´ Respuesta mis-talleres:', response.data);
                
                const misTalleres = response.data.data || [];
                
                const selectTaller = document.getElementById('evento-taller');
                selectTaller.innerHTML = '<option value="">Selecciona un taller...</option>';
                
                if (misTalleres.length === 0) {
                    selectTaller.innerHTML = '<option value="">No tienes talleres asignados</option>';
                    alert('No tienes talleres asignados. Contacta al administrador para que te asigne un taller.');
                    return;
                }
                
                misTalleres.forEach(taller => {
                    const option = document.createElement('option');
                    option.value = taller.id;
                    option.textContent = `${taller.nombre} (${taller.categoria})`;
                    selectTaller.appendChild(option);
                });
                
                console.log('‚úÖ Talleres cargados:', misTalleres.length);
                
            } catch (error) {
                console.error('‚ùå Error al cargar talleres:', error);
                console.error('‚ùå Detalles:', error.response?.data);
                alert('Error al cargar la lista de talleres: ' + (error.response?.data?.message || error.message));
            }
        }
        
        // Guardar evento desde el formulario
        async function guardarEvento(event) {
            event.preventDefault();
            
            const eventoData = {
                taller_id: document.getElementById('evento-taller').value,
                titulo: document.getElementById('evento-titulo').value,
                descripcion: document.getElementById('evento-descripcion').value,
                tipo_evento: document.getElementById('evento-tipo').value,
                fecha_evento: document.getElementById('evento-fecha').value
            };
            
            await crearEvento(eventoData);
            cerrarModalEvento();
        }
        
        // Crear evento en el backend
        async function crearEvento(eventoData) {
            try {
                const response = await axios.post(`${API_BASE_URL}/calendario`, eventoData);
                
                alert('‚úÖ Evento creado exitosamente');
                calendar.refetchEvents();
                
            } catch (error) {
                console.error('‚ùå Error al crear evento:', error);
                alert(error.response?.data?.message || 'Error al crear el evento');
            }
        }
        
        // Mostrar detalle del evento
        function mostrarDetalleEvento(evento) {
            const mensaje = `
T√≠tulo: ${evento.title}
Fecha: ${evento.start.toLocaleDateString('es-MX')}
Tipo: ${evento.extendedProps.tipo}
${evento.extendedProps.taller ? 'Taller: ' + evento.extendedProps.taller : ''}
${evento.extendedProps.description ? 'Descripci√≥n: ' + evento.extendedProps.description : ''}

¬øDeseas eliminar este evento?
            `.trim();
            
            if (confirm(mensaje)) {
                eliminarEvento(evento.id);
            }
        }
        
        // Eliminar evento
        async function eliminarEvento(eventoId) {
            try {
                await axios.delete(`${API_BASE_URL}/calendario/${eventoId}`);
                
                alert('‚úÖ Evento eliminado exitosamente');
                calendar.refetchEvents();
                
            } catch (error) {
                console.error('‚ùå Error al eliminar evento:', error);
                alert(error.response?.data?.message || 'Error al eliminar el evento');
            }
        }
        
        // Verificar autenticaci√≥n al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üîß Iniciando dashboard de instructor...');
            
            const token = localStorage.getItem('token');
            console.log('üîë Token encontrado:', token ? 'S√≠' : 'No');
            
            if (!token) {
                alert('Debes iniciar sesi√≥n para acceder al dashboard');
                window.location.href = 'login.html';
                return;
            }
            
            // Verificar que axios est√© disponible
            if (typeof axios === 'undefined') {
                console.error('‚ùå Axios no est√° disponible');
                alert('Error: La librer√≠a axios no se carg√≥ correctamente');
                return;
            }
            
            console.log('‚úÖ Axios disponible');
            
            // Configurar axios con el token
            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
            console.log('‚úÖ Token configurado en axios');
            
            try {
                console.log('üîÑ Verificando autenticaci√≥n con:', `${API_BASE_URL}/auth/verify`);
                
                // Verificar que el usuario sea instructor
                const response = await axios.get(`${API_BASE_URL}/auth/verify`);
                
                console.log('‚úÖ Respuesta de verificaci√≥n:', response.data);
                
                if (response.data.user.tipo_usuario !== 'instructor') {
                    alert('No tienes permisos para acceder a esta p√°gina');
                    localStorage.removeItem('token');
                    window.location.href = 'login.html';
                    return;
                }
                
                console.log('‚úÖ Usuario es instructor, cargando perfil...');
                
                // Cargar datos del perfil
                await cargarPerfil();
                
            } catch (error) {
                console.error('‚ùå Error al verificar autenticaci√≥n:', error);
                console.error('‚ùå Error completo:', {
                    message: error.message,
                    response: error.response,
                    request: error.request,
                    config: error.config
                });
                
                alert('Sesi√≥n expirada. Por favor, inicia sesi√≥n nuevamente');
                localStorage.removeItem('token');
                window.location.href = 'login.html';
            }
        });
        
        // Cargar perfil del instructor
        async function cargarPerfil() {
            try {
                const response = await axios.get(`${API_BASE_URL}/auth/profile`);
                const perfil = response.data.data;
                
                console.log('üìä Perfil cargado:', perfil);
                console.log('üì¶ Estructura del perfil:', JSON.stringify(perfil, null, 2));
                
                // Llenar el formulario con los datos del perfil
                const nombreInput = document.getElementById('nombre');
                const apellidosInput = document.getElementById('apellidos');
                const especialidadInput = document.getElementById('especialidad');
                const telefonoInput = document.getElementById('telefono');
                const contactoInput = document.getElementById('contacto_emergencia');
                const telefonoEmergenciaInput = document.getElementById('telefono_emergencia');
                const direccionInput = document.getElementById('direccion');
                const descripcionInput = document.getElementById('descripcion');
                
                if (nombreInput) nombreInput.value = perfil.perfil?.nombre || '';
                if (apellidosInput) apellidosInput.value = 
                    `${perfil.perfil?.apellido_paterno || ''} ${perfil.perfil?.apellido_materno || ''}`.trim();
                if (especialidadInput) especialidadInput.value = perfil.perfil?.especialidad || '';
                if (telefonoInput) telefonoInput.value = perfil.perfil?.telefono || '';
                if (contactoInput) contactoInput.value = perfil.perfil?.contacto_emergencia || '';
                if (telefonoEmergenciaInput) telefonoEmergenciaInput.value = perfil.perfil?.telefono_emergencia || '';
                if (direccionInput) direccionInput.value = perfil.perfil?.direccion || '';
                if (descripcionInput) descripcionInput.value = perfil.perfil?.descripcion || '';
                
                // Mostrar informaci√≥n en la tarjeta del lado derecho
                const nombreCompleto = `${perfil.perfil?.nombre || ''} ${perfil.perfil?.apellido_paterno || ''} ${perfil.perfil?.apellido_materno || ''}`.trim();
                
                const instructorNameEl = document.getElementById('instructor-name');
                const instructorEmailEl = document.getElementById('instructor-email');
                const instructorDescEl = document.getElementById('instructor-descripcion');
                const navbarBrandEl = document.querySelector('.navbar-brand');
                
                if (instructorNameEl) instructorNameEl.textContent = nombreCompleto || 'Sin nombre';
                if (instructorEmailEl) instructorEmailEl.textContent = perfil.email || '';
                if (instructorDescEl) instructorDescEl.textContent = perfil.perfil?.descripcion || 'Sin descripci√≥n';
                if (navbarBrandEl) navbarBrandEl.textContent = nombreCompleto || 'Instructor';
                
                console.log('‚úÖ Perfil cargado exitosamente en el frontend');
                
            } catch (error) {
                console.error('‚ùå Error al cargar perfil:', error);
                console.error('‚ùå Stack trace:', error.stack);
                alert('Error al cargar la informaci√≥n del perfil');
            }
        }
        
        // Actualizar perfil
        async function actualizarPerfil(event) {
            event.preventDefault();
            
            const nombre = document.getElementById('nombre').value.trim();
            const apellidosCompletos = document.getElementById('apellidos').value.trim();
            const especialidad = document.getElementById('especialidad').value.trim();
            const telefono = document.getElementById('telefono').value.trim();
            const contacto_emergencia = document.getElementById('contacto_emergencia').value.trim();
            const telefono_emergencia = document.getElementById('telefono_emergencia').value.trim();
            const direccion = document.getElementById('direccion').value.trim();
            const descripcion = document.getElementById('descripcion').value.trim();
            
            // Validar campos requeridos
            if (!nombre || !apellidosCompletos) {
                alert('Por favor completa los campos de nombre y apellidos');
                return;
            }
            
            // Separar apellidos (paterno y materno)
            const apellidos = apellidosCompletos.split(' ');
            const apellido_paterno = apellidos[0] || '';
            const apellido_materno = apellidos.slice(1).join(' ') || '';
            
            if (!apellido_paterno) {
                alert('Por favor ingresa al menos un apellido');
                return;
            }
            
            try {
                const response = await axios.put(`${API_BASE_URL}/auth/profile`, {
                    nombre,
                    apellido_paterno,
                    apellido_materno,
                    especialidad,
                    telefono,
                    contacto_emergencia,
                    telefono_emergencia,
                    direccion,
                    descripcion
                });
                
                alert('‚úÖ Perfil actualizado exitosamente');
                
                // Recargar el perfil para mostrar los cambios
                await cargarPerfil();
                
            } catch (error) {
                console.error('‚ùå Error al actualizar perfil:', error);
                alert(error.response?.data?.message || 'Error al actualizar el perfil');
            }
        }
        
        // Cerrar sesi√≥n
        function cerrarSesion() {
            localStorage.removeItem('token');
            window.location.href = 'index.html';
        }
        
        // ============================================
        // FUNCIONES PARA M√ìDULO DE AVISOS
        // ============================================
        
        let avisosData = []; // Almacenar avisos para b√∫squeda
        
        // Cargar avisos cuando se muestra la secci√≥n
        function mostrarSeccionAvisos() {
            mostrarSeccion('avisos');
            cargarAvisos();
        }
        
        // Cargar avisos del instructor
        async function cargarAvisos() {
            try {
                const response = await axios.get(`${API_BASE_URL}/avisos/mis-avisos`, {
                    params: { limit: 100 }
                });
                
                avisosData = response.data.data || [];
                mostrarAvisosEnTabla(avisosData);
                
            } catch (error) {
                console.error('‚ùå Error al cargar avisos:', error);
                document.getElementById('tabla-avisos').innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-danger">
                            <i class="pe-7s-attention"></i>
                            <p>Error al cargar los avisos</p>
                        </td>
                    </tr>
                `;
            }
        }
        
        // Mostrar avisos en la tabla
        function mostrarAvisosEnTabla(avisos) {
            const tbody = document.getElementById('tabla-avisos');
            
            if (!avisos || avisos.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">
                            <i class="pe-7s-info"></i>
                            <p>No tienes avisos registrados</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = avisos.map(aviso => {
                const fecha = new Date(aviso.fecha_publicacion).toLocaleString('es-MX');
                const importante = aviso.importante ? '<span class="label label-danger">Importante</span>' : '';
                const estadoClass = aviso.activo ? 'success' : 'default';
                const estadoTexto = aviso.activo ? 'Activo' : 'Inactivo';
                const contenidoCorto = aviso.contenido.length > 50 
                    ? aviso.contenido.substring(0, 50) + '...' 
                    : aviso.contenido;
                
                return `
                    <tr>
                        <td><strong>${aviso.taller_nombre || 'Sin taller'}</strong></td>
                        <td>${aviso.titulo}</td>
                        <td>${contenidoCorto}</td>
                        <td>${fecha}</td>
                        <td>${importante}</td>
                        <td><span class="label label-${estadoClass}">${estadoTexto}</span></td>
                        <td>
                            <button class="btn btn-info btn-sm" onclick="verDetalleAviso('${aviso.id}')" title="Ver detalle">
                                <i class="pe-7s-look"></i>
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="editarAviso('${aviso.id}')" title="Editar">
                                <i class="pe-7s-pen"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="eliminarAviso('${aviso.id}')" title="Eliminar">
                                <i class="pe-7s-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Mostrar modal para crear aviso
        async function mostrarModalAviso(avisoId = null) {
            document.getElementById('tituloModalAviso').textContent = avisoId ? 'Editar Aviso' : 'Nuevo Aviso';
            document.getElementById('modalAviso').style.display = 'block';
            document.querySelector('#modalAviso .modal-dialog').parentElement.classList.add('in');
            document.querySelector('#modalAviso .modal-dialog').parentElement.style.display = 'block';
            
            // Cargar talleres en el select
            await cargarTalleresParaAvisos();
            
            // Si es edici√≥n, cargar datos del aviso
            if (avisoId) {
                const aviso = avisosData.find(a => a.id === avisoId);
                if (aviso) {
                    document.getElementById('aviso-id').value = aviso.id;
                    document.getElementById('aviso-taller').value = aviso.taller_id;
                    document.getElementById('aviso-titulo').value = aviso.titulo;
                    document.getElementById('aviso-contenido').value = aviso.contenido;
                    document.getElementById('aviso-importante').checked = aviso.importante;
                    
                    // Formatear fechas para datetime-local
                    if (aviso.fecha_publicacion) {
                        const fechaPub = new Date(aviso.fecha_publicacion);
                        document.getElementById('aviso-fecha-publicacion').value = 
                            fechaPub.toISOString().slice(0, 16);
                    }
                    if (aviso.fecha_expiracion) {
                        const fechaExp = new Date(aviso.fecha_expiracion);
                        document.getElementById('aviso-fecha-expiracion').value = 
                            fechaExp.toISOString().slice(0, 16);
                    }
                }
            } else {
                // Limpiar formulario
                document.getElementById('formAviso').reset();
                document.getElementById('aviso-id').value = '';
                
                // Establecer fecha actual como predeterminada
                const ahora = new Date();
                document.getElementById('aviso-fecha-publicacion').value = 
                    ahora.toISOString().slice(0, 16);
            }
        }
        
        // Cerrar modal de aviso
        function cerrarModalAviso() {
            document.getElementById('modalAviso').style.display = 'none';
            document.querySelector('#modalAviso .modal-dialog').parentElement.classList.remove('in');
            document.getElementById('formAviso').reset();
        }
        
        // Cargar talleres para avisos
        async function cargarTalleresParaAvisos() {
            try {
                const response = await axios.get(`${API_BASE_URL}/talleres/mis-talleres`);
                const talleres = response.data.data || [];
                
                const select = document.getElementById('aviso-taller');
                select.innerHTML = '<option value="">Selecciona un taller...</option>';
                
                talleres.forEach(taller => {
                    const option = document.createElement('option');
                    option.value = taller.id;
                    option.textContent = `${taller.nombre} (${taller.categoria})`;
                    select.appendChild(option);
                });
                
            } catch (error) {
                console.error('‚ùå Error al cargar talleres:', error);
                alert('Error al cargar la lista de talleres');
            }
        }
        
        // Guardar aviso (crear o actualizar)
        async function guardarAviso() {
            const avisoId = document.getElementById('aviso-id').value;
            const taller_id = document.getElementById('aviso-taller').value;
            const titulo = document.getElementById('aviso-titulo').value.trim();
            const contenido = document.getElementById('aviso-contenido').value.trim();
            const importante = document.getElementById('aviso-importante').checked;
            const fecha_publicacion = document.getElementById('aviso-fecha-publicacion').value;
            const fecha_expiracion = document.getElementById('aviso-fecha-expiracion').value || null;
            
            // Validar campos requeridos
            if (!taller_id || !titulo || !contenido || !fecha_publicacion) {
                alert('Por favor completa todos los campos requeridos');
                return;
            }
            
            try {
                const data = {
                    taller_id,
                    titulo,
                    contenido,
                    importante,
                    fecha_publicacion,
                    fecha_expiracion
                };
                
                if (avisoId) {
                    // Actualizar aviso existente
                    await axios.put(`${API_BASE_URL}/avisos/${avisoId}`, data);
                    alert('‚úÖ Aviso actualizado exitosamente');
                } else {
                    // Crear nuevo aviso
                    await axios.post(`${API_BASE_URL}/avisos`, data);
                    alert('‚úÖ Aviso creado exitosamente');
                }
                
                cerrarModalAviso();
                await cargarAvisos();
                
            } catch (error) {
                console.error('‚ùå Error al guardar aviso:', error);
                alert(error.response?.data?.message || 'Error al guardar el aviso');
            }
        }
        
        // Ver detalle del aviso
        function verDetalleAviso(avisoId) {
            const aviso = avisosData.find(a => a.id === avisoId);
            if (!aviso) return;
            
            const fecha = new Date(aviso.fecha_publicacion).toLocaleString('es-MX');
            const expiracion = aviso.fecha_expiracion 
                ? new Date(aviso.fecha_expiracion).toLocaleString('es-MX') 
                : 'Sin expiraci√≥n';
            
            const mensaje = `
üìã Detalle del Aviso

Taller: ${aviso.taller_nombre}
T√≠tulo: ${aviso.titulo}
Contenido: ${aviso.contenido}
Fecha de publicaci√≥n: ${fecha}
Fecha de expiraci√≥n: ${expiracion}
Importante: ${aviso.importante ? 'S√≠' : 'No'}
Estado: ${aviso.activo ? 'Activo' : 'Inactivo'}
            `.trim();
            
            alert(mensaje);
        }
        
        // Editar aviso
        function editarAviso(avisoId) {
            mostrarModalAviso(avisoId);
        }
        
        // Eliminar aviso
        async function eliminarAviso(avisoId) {
            if (!confirm('¬øEst√°s seguro de que deseas eliminar este aviso?')) {
                return;
            }
            
            try {
                await axios.delete(`${API_BASE_URL}/avisos/${avisoId}`);
                alert('‚úÖ Aviso eliminado exitosamente');
                await cargarAvisos();
                
            } catch (error) {
                console.error('‚ùå Error al eliminar aviso:', error);
                alert(error.response?.data?.message || 'Error al eliminar el aviso');
            }
        }
        
        // ============================================
        // FUNCIONES PARA M√ìDULO DE ALUMNOS INSCRITOS
        // ============================================
        
        let alumnosData = []; // Almacenar alumnos para b√∫squeda
        let alumnosCompletos = []; // Almacenar todos los datos de alumnos
        let tallerSeleccionadoId = '';
        
        // Cargar talleres para seleccionar
        async function cargarTalleresParaAlumnos() {
            try {
                const response = await axios.get(`${API_BASE_URL}/talleres/mis-talleres`);
                const talleres = response.data.data || [];
                
                const select = document.getElementById('select-taller-alumnos');
                select.innerHTML = '<option value="">Selecciona un taller...</option>';
                
                talleres.forEach(taller => {
                    const option = document.createElement('option');
                    option.value = taller.id;
                    option.textContent = `${taller.nombre} (${taller.categoria})`;
                    select.appendChild(option);
                });
                
            } catch (error) {
                console.error('‚ùå Error al cargar talleres:', error);
            }
        }
        
        // Cargar alumnos por taller
        async function cargarAlumnosPorTaller() {
            const tallerId = document.getElementById('select-taller-alumnos').value;
            tallerSeleccionadoId = tallerId;
            
            if (!tallerId) {
                document.getElementById('tabla-alumnos').innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">
                            <p>Selecciona un taller para ver los alumnos inscritos</p>
                        </td>
                    </tr>
                `;
                document.getElementById('total-alumnos').textContent = '0 alumnos';
                return;
            }
            
            try {
                document.getElementById('tabla-alumnos').innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">
                            <i class="pe-7s-refresh" style="font-size: 24px;"></i>
                            <p>Cargando alumnos...</p>
                        </td>
                    </tr>
                `;
                
                const response = await axios.get(`${API_BASE_URL}/talleres/${tallerId}/alumnos`);
                alumnosCompletos = response.data.data || [];
                alumnosData = [...alumnosCompletos];
                
                mostrarAlumnosEnTabla(alumnosData);
                document.getElementById('total-alumnos').textContent = `${alumnosData.length} alumno${alumnosData.length !== 1 ? 's' : ''}`;
                
            } catch (error) {
                console.error('‚ùå Error al cargar alumnos:', error);
                document.getElementById('tabla-alumnos').innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-danger">
                            <i class="pe-7s-attention"></i>
                            <p>Error al cargar los alumnos inscritos</p>
                        </td>
                    </tr>
                `;
            }
        }
        
        // Mostrar alumnos en la tabla
        function mostrarAlumnosEnTabla(alumnos) {
            const tbody = document.getElementById('tabla-alumnos');
            
            if (!alumnos || alumnos.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">
                            <i class="pe-7s-info"></i>
                            <p>No hay alumnos inscritos en este taller</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = alumnos.map(alumno => {
                const nombreCompleto = `${alumno.nombre} ${alumno.apellido_paterno} ${alumno.apellido_materno || ''}`.trim();
                
                return `
                    <tr>
                        <td><strong>${alumno.numero_control}</strong></td>
                        <td>${nombreCompleto}</td>
                        <td>${alumno.grupo || '-'}</td>
                        <td>${alumno.semestre || '-'}</td>
                        <td>${alumno.email || '-'}</td>
                        <td>${alumno.telefono || '-'}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="verInformacionEmergencia('${alumno.perfil_id}')" title="Ver informaci√≥n de emergencia">
                                <i class="pe-7s-attention"></i> Emergencia
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Buscar alumno
        function buscarAlumno() {
            const busqueda = document.getElementById('buscar-alumno').value.toLowerCase().trim();
            
            if (!busqueda) {
                alumnosData = [...alumnosCompletos];
            } else {
                alumnosData = alumnosCompletos.filter(alumno => {
                    const nombreCompleto = `${alumno.nombre} ${alumno.apellido_paterno} ${alumno.apellido_materno || ''}`.toLowerCase();
                    const numeroControl = (alumno.numero_control || '').toLowerCase();
                    const email = (alumno.email || '').toLowerCase();
                    
                    return nombreCompleto.includes(busqueda) || 
                           numeroControl.includes(busqueda) || 
                           email.includes(busqueda);
                });
            }
            
            mostrarAlumnosEnTabla(alumnosData);
            document.getElementById('total-alumnos').textContent = `${alumnosData.length} alumno${alumnosData.length !== 1 ? 's' : ''}`;
        }
        
        // Ver informaci√≥n de emergencia
        function verInformacionEmergencia(perfilId) {
            const alumno = alumnosCompletos.find(a => a.perfil_id === perfilId);
            if (!alumno) return;
            
            // Llenar modal con datos del alumno
            const nombreCompleto = `${alumno.nombre} ${alumno.apellido_paterno} ${alumno.apellido_materno || ''}`.trim();
            document.getElementById('emergencia-nombre-alumno').textContent = nombreCompleto;
            document.getElementById('emergencia-datos-alumno').textContent = 
                `${alumno.numero_control} | ${alumno.grupo || '-'} | Semestre ${alumno.semestre || '-'}`;
            
            // Informaci√≥n de contacto de emergencia
            document.getElementById('emergencia-contacto-nombre').textContent = 
                alumno.contacto_emergencia_nombre || 'No registrado';
            document.getElementById('emergencia-contacto-telefono').textContent = 
                alumno.contacto_emergencia_telefono || 'No registrado';
            document.getElementById('emergencia-contacto-relacion').textContent = 
                alumno.contacto_emergencia_relacion || 'No registrado';
            
            // Informaci√≥n m√©dica
            document.getElementById('emergencia-tipo-sangre').textContent = 
                alumno.tipo_sangre || 'No registrado';
            document.getElementById('emergencia-alergias').textContent = 
                alumno.alergias || 'Ninguna registrada';
            document.getElementById('emergencia-medicamentos').textContent = 
                alumno.medicamentos || 'Ninguno registrado';
            document.getElementById('emergencia-condiciones').textContent = 
                alumno.condiciones_medicas || 'Ninguna registrada';
            
            // Mostrar modal
            document.getElementById('modalEmergencia').style.display = 'block';
            document.querySelector('#modalEmergencia .modal-dialog').parentElement.classList.add('in');
            document.querySelector('#modalEmergencia .modal-dialog').parentElement.style.display = 'block';
        }
        
        // Cerrar modal de emergencia
        function cerrarModalEmergencia() {
            document.getElementById('modalEmergencia').style.display = 'none';
            document.querySelector('#modalEmergencia .modal-dialog').parentElement.classList.remove('in');
        }
    </script>

</html>