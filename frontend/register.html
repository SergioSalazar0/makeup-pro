<!doctype html>
<html lang="en">
  <head>
   <!-- basic -->
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <!-- mobile metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="viewport" content="initial-scale=1, maximum-scale=1">
   <!-- site metas -->
   <title>Talleres CBTis258</title>
   <meta name="keywords" content="">
   <meta name="description" content="">
   <meta name="author" content="">
   <link rel="shortcut icon" href="images/image logo.png" title="Favicon"/>
   <!-- bootstrap css -->
   <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
   <!-- style css -->
   <link rel="stylesheet" type="text/css" href="css/style.css">
   <!-- Responsive-->
   <link rel="stylesheet" href="css/responsive.css">
   <!-- fevicon -->
   <link rel="icon" href="images/fevicon.png" type="image/gif" />
   <!-- Scrollbar Custom CSS -->
   <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
   <!-- Tweaks for older IEs-->
   <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
   <!-- owl stylesheets --> 
   <link rel="stylesheet" href="css/owl.carousel.min.css">
   <link rel="stylesheet" href="css/owl.theme.default.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
   <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="shortcut icon" href="images/image logo.png" title="Favicon"/>
  <link rel="stylesheet" href="css/register.css">
  <title>login</title>
  </head>
  <body>
    <style>
        body { background-image: url("img-actu/alexa.jpeg");}
    </style>   
    <!-- header section start -->
    <div class="header_section">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
         <a class="logo" href="index.html"><img src="images/logoop1.png"></a>
         <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
         <span class="navbar-toggler-icon"></span>
         </button>
         <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
               <li class="nav-item active">
                  <a class="nav-link" href="index.html">Principal</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="culturales.html">Culturales</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="deportes.html">Deportes</a>
               </li>
               <li class="nav-item">
                  <a class="nav-link" href="civicos.html">Civicos</a>
               </li>
            </ul>
           
            <div class="search_icon"><a href="login.html"><img src="images/user-icon.png"><span class="padding_left_15">Ingresar</span></a></div>
            <div class="search_icon"><a href="#"><img src="images/search-icon.png"><span class="padding_left_15">Buscar...</span></a>
            
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Notificaci√≥n de B√∫squeda</title>
                    <link rel="stylesheet" href="styles.css">
                </head>
                
               
                </div>
         </div>
      </nav>
   </div>
   <!-- header section end -->
   
   <section class="form-register">
      <h4>Crea tu cuenta</h4>
      <p style="text-align: center; color: #ccc; margin-bottom: 20px;">
          Registra tu cuenta
      </p>
      <form id="registerForm">
          <input class="controls" type="email" name="email" id="email" placeholder="Correo Electr√≥nico" required>
          <input class="controls" type="password" name="password" id="password" placeholder="Contrase√±a (m√≠nimo 6 caracteres)" required>
          
          <div class="select-container">
              <label for="taller_interes">¬øTe interesa alg√∫n taller? (opcional):</label>
              <select class="controls" name="taller_interes" id="taller_interes">
                  <option value="">Explorar√© los talleres despu√©s...</option>
                  <!-- Opciones se cargar√°n din√°micamente -->
              </select>
          </div>
          
          <div style="background: #1f53c5; padding: 10px; border-radius: 4px; margin: 15px 0;">
              <small style="color: white;">
                  üìù <strong>Despu√©s del registro:</strong><br>
                  ‚Ä¢ Podr√°s completar tu perfil desde el dashboard<br>
              </small>
          </div>
          
          <p>Estoy de acuerdo con estos <a href="#">T√©rminos y Condiciones</a></p>
          <button class="botons" type="submit">Crear mi cuenta</button>
          <p><a href="login.html">¬øYa tienes una cuenta?</a></p>
      </form>
  </section>


  <script src="./js/config.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>

      
      // Cargar talleres disponibles al cargar la p√°gina
      document.addEventListener('DOMContentLoaded', async () => {
          await cargarTalleres();
      });
      
      // Funci√≥n para cargar talleres en el dropdown
      async function cargarTalleres() {
          try {
              const response = await axios.get(`${API_BASE_URL}/talleres`);
              const talleres = response.data.data || response.data;
              
              const selectTaller = document.getElementById('taller_interes');
              
              talleres.forEach(taller => {
                  const option = document.createElement('option');
                  option.value = taller.id;
                  option.textContent = `${taller.nombre} (${taller.categoria})`;
                  selectTaller.appendChild(option);
              });
          } catch (error) {
              console.error('Error al cargar talleres:', error);
          }
      }

      const registerForm = document.querySelector('#registerForm');
      
      // Al enviar el formulario
      registerForm.addEventListener('submit', async (e) => {
          e.preventDefault();

          const formData = {
              email: e.target.email.value,
              password: e.target.password.value
          };

          try {
              const response = await axios.post(`${API_BASE_URL}/auth/register`, formData);

              if (response.status === 201) {
                  // Guardar token para despu√©s intentar inscripci√≥n
                  const token = response.data.token;
                  const tallerSeleccionado = e.target.taller_interes.value;
                  
                  // Mostrar mensaje de √©xito
                  alert(`¬°Registro exitoso! ${response.data.message}`);
                  
                  // Si seleccion√≥ un taller, intentar inscripci√≥n autom√°tica
                  if (tallerSeleccionado && token) {
                      try {
                          await axios.post(
                              `${API_BASE_URL}/talleres/${tallerSeleccionado}/inscripcion`,
                              { 
                                  comentarios: 'Inscripci√≥n autom√°tica desde registro - Completar perfil pendiente' 
                              },
                              { headers: { Authorization: `Bearer ${token}` } }
                          );
                          alert('¬°Tambi√©n te hemos pre-inscrito al taller seleccionado! Completa tu perfil para confirmar la inscripci√≥n.');
                      } catch (error) {
                          console.error('Error al inscribir al taller:', error);
                          alert('Nota: No pudimos inscribirte autom√°ticamente al taller. Podr√°s hacerlo desde tu dashboard.');
                      }
                  }
                  
                  // Guardar token y redirigir al login para que el usuario ingrese
                  localStorage.setItem('newUserToken', token);
                  localStorage.setItem('needsProfile', 'true');
                  
                  setTimeout(() => {
                      window.location.href = 'login.html';
                  }, 2000);
              }
          } catch (error) {
              console.error('Error al registrar:', error);
              
              if (error.response?.data?.details) {
                  const errores = error.response.data.details.map(err => err.message).join('\n');
                  alert(`Errores de validaci√≥n:\n${errores}`);
              } else {
                  alert(error.response?.data?.message || 'Ocurri√≥ un error, por favor intente m√°s tarde.');
              }
          }
      });
  </script>
    </body>
</html>